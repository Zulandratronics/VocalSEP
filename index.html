<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VocalSep - Advanced Audio Editor with Voice Separation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @keyframes wave {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        .animate-wave {
            animation: wave 1.5s infinite ease-in-out;
        }
        .audio-wave {
            height: 40px;
            background: linear-gradient(90deg, #3b82f6, #ec4899);
            -webkit-mask-image: url('data:image/svg+xml;utf8,<svg viewBox="0 0 100 20" xmlns="http://www.w3.org/2000/svg"><path d="M0 10 Q 5 15 10 10 T 20 10 T 30 10 T 40 10 T 50 10 T 60 10 T 70 10 T 80 10 T 90 10 T 100 10" stroke="black" fill="none" stroke-width="2"/></svg>');
            mask-image: url('data:image/svg+xml;utf8,<svg viewBox="0 0 100 20" xmlns="http://www.w3.org/2000/svg"><path d="M0 10 Q 5 15 10 10 T 20 10 T 30 10 T 40 10 T 50 10 T 60 10 T 70 10 T 80 10 T 90 10 T 100 10" stroke="black" fill="none" stroke-width="2"/></svg>');
            -webkit-mask-size: 100% 100%;
            mask-size: 100% 100%;
        }
        .timeline-handle {
            width: 12px;
            height: 25px;
            top: -5px;
        }
        .track-height {
            height: 80px;
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* Tutorial styling */
        .tutorial-step {
            transition: all 0.3s ease;
        }
        .tutorial-step:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 font-sans">
    <div class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 shadow-lg">
            <div class="container mx-auto flex justify-between items-center">
                <div class="flex items-center space-x-2">
                    <i class="fas fa-wave-square text-2xl animate-wave"></i>
                    <h1 class="text-2xl font-bold">VocalSep</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="importBtn" class="bg-white text-blue-600 px-4 py-2 rounded-full font-semibold hover:bg-blue-50 transition">
                        <i class="fas fa-cloud-upload-alt mr-2"></i> Import Audio
                    </button>
                    <button id="exportBtn" class="bg-purple-500 text-white px-4 py-2 rounded-full font-semibold hover:bg-purple-600 transition">
                        <i class="fas fa-save mr-2"></i> Export Project
                    </button>
                    <button id="tutorialBtn" class="bg-blue-500 text-white px-4 py-2 rounded-full font-semibold hover:bg-blue-600 transition">
                        <i class="fas fa-graduation-cap mr-2"></i> Tutorial
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-1 container mx-auto p-4 flex flex-col lg:flex-row gap-6">
            <!-- Left Panel - Tools and Effects -->
            <div class="w-full lg:w-64 bg-white rounded-xl shadow-md p-4 h-fit">
                <h2 class="text-lg font-semibold mb-4 text-gray-700 flex items-center">
                    <i class="fas fa-tools mr-2 text-blue-500"></i> Audio Tools
                </h2>
                
                <div class="space-y-4">
                    <!-- Voice Separation -->
                    <div class="p-3 bg-blue-50 rounded-lg border border-blue-100">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="font-medium text-blue-800">
                                <i class="fas fa-users mr-2"></i> Voice Separation
                            </h3>
                            <button class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">
                                AI
                            </button>
                        </div>
                        <p class="text-xs text-gray-600 mb-3">
                            Detect and separate multiple voices in your audio
                        </p>
                        <button id="separateBtn" class="w-full bg-blue-600 text-white py-2 rounded-lg text-sm hover:bg-blue-700 transition flex items-center justify-center">
                            <i class="fas fa-magic mr-2"></i> Separate Voices
                        </button>
                        <div class="mt-2">
                            <input type="text" id="hfApiKey" placeholder="Hugging Face API Key (optional)" class="w-full p-1 text-xs border rounded">
                        </div>
                    </div>

                    <!-- Audio Effects -->
                    <div>
                        <h3 class="font-medium text-gray-700 mb-2 flex items-center">
                            <i class="fas fa-sliders-h mr-2 text-purple-500"></i> Effects
                        </h3>
                        <div class="space-y-2">
                            <select id="effectSelect" class="w-full p-2 border rounded-lg text-sm">
                                <option value="none">None</option>
                                <option value="highpass">High Pass Filter</option>
                                <option value="lowpass">Low Pass Filter</option>
                                <option value="delay">Delay</option>
                                <option value="reverb">Reverb</option>
                            </select>
                            <button id="applyEffectBtn" class="w-full bg-gray-200 text-gray-700 py-2 rounded-lg text-sm hover:bg-gray-300 transition">
                                Apply Effect
                            </button>
                        </div>
                    </div>

                    <!-- Playback Controls -->
                    <div class="pt-2 border-t mt+4">
                        <h3 class="font-medium text-gray-700 mb-2 flex items-center">
                            <i class="fas fa-play-circle mr-2 text-green-500"></i> Playback
                        </h3>
                        <div class="grid grid-cols-3 gap-2">
                            <button id="playBtn" class="p-2 bg-green-100 rounded-lg hover:bg-green-200 flex flex-col items-center">
                                <i class="fas fa-play text-green-600 mb-1"></i>
                                <span class="text-xs">Play</span>
                            </button>
                            <button id="pauseBtn" class="p-2 bg-yellow-100 rounded-lg hover:bg-yellow-200 flex flex-col items-center">
                                <i class="fas fa-pause text-yellow-600 mb-1"></i>
                                <span class="text-xs">Pause</span>
                            </button>
                            <button id="stopBtn" class="p-2 bg-red-100 rounded-lg hover:bg-red-200 flex flex-col items-center">
                                <i class="fas fa-stop text-red-600 mb-1"></i>
                                <span class="text-xs">Stop</span>
                            </button>
                        </div>
                        <div class="mt-2">
                            <div class="flex justify-between text-xs text-gray-600 mb-1">
                                <span>Volume</span>
                                <span id="volumeValue">100%</span>
                            </div>
                            <input id="volumeControl" type="range" min="0" max="100" value="100" class="w-full accent-blue-500">
                        </div>
                    </div>

                    <!-- Audio Timeline Tools -->
                    <div class="pt-2 border-t mt-4">
                        <h3 class="font-medium text-gray-700 mb-2 flex items-center">
                            <i class="fas fa-cut mr-2 text-red-500"></i> Editing Tools
                        </h3>
                        <div class="grid grid-cols-4 gap-2">
                            <button id="cutBtn" class="p-2 bg-gray-100 rounded-lg hover:bg-gray-200 flex flex-col items-center">
                                <i class="fas fa-cut text-red-500 mb-1"></i>
                                <span class="text-xs">Cut</span>
                            </button>
                            <button id="copyBtn" class="p-2 bg-gray-100 rounded-lg hover:bg-gray-200 flex flex-col items-center">
                                <i class="fas fa-copy text-blue-500 mb-1"></i>
                                <span class="text-xs">Copy</span>
                            </button>
                            <button id="pasteBtn" class="p-2 bg-gray-100 rounded-lg hover:bg-gray-200 flex flex-col items-center">
                                <i class="fas fa-paste text-green-500 mb-1"></i>
                                <span class="text-xs">Paste</span>
                            </button>
                            <button id="undoBtn" class="p-2 bg-gray-100 rounded-lg hover:bg-gray-200 flex flex-col items-center">
                                <i class="fas fa-undo text-purple-500 mb-1"></i>
                                <span class="text-xs">Undo</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Center Panel - Timeline Editor -->
            <div class="flex-1 bg-white rounded-xl shadow-md p-4">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold text-gray-700 flex items-center">
                        <i class="fas fa-timeline mr-2 text-purple-500"></i> Multi-Track Timeline
                    </h2>
                    <div class="flex space-x-2">
                        <button class="p-2 bg-gray-100 rounded-lg hover:bg-gray-200">
                            <i class="fas fa-plus text-blue-500"></i>
                        </button>
                        <button class="p-2 bg-gray-100 rounded-lg hover:bg-gray-200">
                            <i class="fas fa-cog text-gray-500"></i>
                        </button>
                    </div>
                </div>

                <!-- Timeline Controls -->
                <div class="flex items-center justify-between mb-2 bg-gray-50 p-2 rounded-lg">
                    <div class="flex items-center space-x-2">
                        <button id="playBtnLarge" class="p-1 text-gray-500 hover:text-blue-500">
                            <i class="fas fa-play-circle text-2xl"></i>
                        </button>
                        <button id="stopBtnLarge" class="p-1 text-gray-500 hover:text-red-500">
                            <i class="fas fa-stop-circle text-2xl"></i>
                        </button>
                        <button class="p-1 text-gray-500 hover:text-green-500">
                            <i class="fas fa-redo text-xl"></i>
                        </button>
                        <span id="timeDisplay" class="text-sm font-mono bg-white px-2 py-1 rounded">
                            00:00:00
                        </span>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center text-sm">
                            <span class="mr-2">Zoom:</span>
                            <input type="range" class="w-24 accent-blue-500">
                        </div>
                        <div class="flex items-center">
                            <button class="p-1 text-gray-500 hover:text-blue-500">
                                <i class="fas fa-headphones"></i>
                            </button>
                            <span class="mx-2 text-gray-400">|</span>
                            <button class="p-1 text-gray-500 hover:text-blue-500">
                                <i class="fas fa-ruler-horizontal"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Main Timeline -->
                <div class="border rounded-lg overflow-hidden">
                    <!-- Time Ruler -->
                    <div class="bg-gray-100 h-8 flex items-center px-2 border-b relative">
                        <div class="absolute left-0 top-0 bottom-0 w-px bg-red-500 ml-20 timeline-handle"></div>
                        <div class="flex space-x-8">
                            <span class="text-xs font-mono">00:00:00</span>
                            <span class="text-xs font-mono">00:00:05</span>
                            <span class="text-xs font-mono">00:00:10</span>
                            <span class="text-xs font-mono">00:00:15</span>
                        </div>
                    </div>

                    <!-- Audio Tracks -->
                    <div class="overflow-y-auto" style="max-height: 400px;">
                        <!-- Original Track -->
                        <div class="border-b track-height relative" id="originalTrack">
                            <div class="absolute left-0 top-0 bottom-0 w-20 bg-gray-50 flex items-center justify-center border-r">
                                <span class="text-xs text-gray-600 rotate-90 whitespace-nowrap">Original Audio</span>
                            </div>
                            <div class="ml-20 h-full relative">
                                <div class="audio-wave absolute top-0 left-0 right-0 bottom-0 m-2 rounded" id="originalWaveform"></div>
                                <div class="absolute top-0 left-0 right-0 bottom-0 flex items-center justify-center">
                                    <div id="fileNameDisplay" class="text-xs bg-white bg-opacity-80 px-2 py-1 rounded">
                                        No file loaded
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Separated Tracks (initially hidden) -->
                        <div id="separatedTracks" class="hidden">
                            <!-- Separated Voice 1 (Male) -->
                            <div class="border-b track-height relative" id="maleVoiceTrack">
                                <div class="absolute left-0 top-0 bottom-0 w-20 bg-gray-50 flex items-center justify-center border-r">
                                    <span class="text-xs text-blue-600 rotate-90 whitespace-nowrap">Voice 1 (Male)</span>
                                </div>
                                <div class="ml-20 h-full relative">
                                    <div class="absolute top-0 left-0 right-0 bottom-0 m-2 rounded bg-blue-50 border border-blue-200">
                                        <div class="audio-wave absolute top-0 left-0 right-0 bottom-0 opacity-70" style="background: linear-gradient(90deg, #3b82f6, #93c5fd);" id="maleWaveform"></div>
                                    </div>
                                    <div class="absolute top-1 right-1 flex space-x-1">
                                        <button class="w-5 h-5 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-xs hover:bg-blue-200" title="Play male voice" id="playMaleBtn">
                                            <i class="fas fa-volume-up"></i>
                                        </button>
                                        <button class="w-5 h-5 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-xs hover:bg-blue-200" title="Download male voice" id="downloadMaleBtn">
                                            <i class="fas fa-download"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Separated Voice 2 (Female) -->
                            <div class="border-b track-height relative" id="femaleVoiceTrack">
                                <div class="absolute left-0 top-0 bottom-0 w-20 bg-gray-50 flex items-center justify-center border-r">
                                    <span class="text-xs text-purple-600 rotate-90 whitespace-nowrap">Voice 2 (Female)</span>
                                </div>
                                <div class="ml-20 h-full relative">
                                    <div class="absolute top-0 left-0 right-0 bottom-0 m-2 rounded bg-purple-50 border border-purple-200">
                                        <div class="audio-wave absolute top-0 left-0 right-0 bottom-0 opacity-70" style="background: linear-gradient(90deg, #8b5cf6, #c4b5fd);" id="femaleWaveform"></div>
                                    </div>
                                    <div class="absolute top-1 right-1 flex space-x-1">
                                        <button class="w-5 h-5 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center text-xs hover:bg-purple-200" title="Play female voice" id="playFemaleBtn">
                                            <i class="fas fa-volume-up"></i>
                                        </button>
                                        <button class="w-5 h-5 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center text-xs hover:bg-purple-200" title="Download female voice" id="downloadFemaleBtn">
                                            <i class="fas fa-download"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Separated Background -->
                            <div class="border-b track-height relative">
                                <div class="absolute left-0 top-0 bottom-0 w-20 bg-gray-50 flex items-center justify-center border-r">
                                    <span class="text-xs text-gray-600 rotate-90 whitespace-nowrap">Background</span>
                                </div>
                                <div class="ml-20 h-full relative">
                                    <div class="absolute top-0 left-0 right-0 bottom-0 m-2 rounded bg-gray-50 border border-gray-200">
                                        <div class="audio-wave absolute top-0 left-0 right-0 bottom-0 opacity-70" style="background: linear-gradient(90deg, #6b7280, #9ca3af);"></div>
                                    </div>
                                    <div class="absolute top-1 right-1 flex space-x-1">
                                        <button class="w-5 h-5 rounded-full bg-gray-100 text-gray-600 flex items-center justify-center text-xs hover:bg-gray-200">
                                            <i class="fas fa-volume-up"></i>
                                        </button>
                                        <button class="w-5 h-5 rounded-full bg-gray-100 text-gray-600 flex items-center justify-center text-xs hover:bg-gray-200">
                                            <i class="fas fa-sliders-h"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel - Analysis and Details -->
            <div class="w-full lg:w-80 bg-white rounded-xl shadow-md p-4 h-fit">
                <h2 class="text-lg font-semibold mb-4 text-gray-700 flex items-center">
                    <i class="fas fa-chart-bar mr-2 text-green-500"></i> Audio Analysis
                </h2>

                <div class="space-y-4">
                    <!-- Voice Separation Results -->
                    <div id="analysisInfo" class="hidden p-3 bg-green-50 rounded-lg border border-green-100">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="font-medium text-green-800">
                                <i class="fas fa-check-circle mr-2"></i> Separation Complete
                            </h3>
                            <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">
                                98% Accuracy
                            </span>
                        </div>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Voices Detected:</span>
                                <span class="font-medium">2</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Background Noise:</span>
                                <span class="font-medium">Clean</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Processing Time:</span>
                                <span class="font-medium">4.2s</span>
                            </div>
                        </div>
                    </div>

                    <!-- Audio Properties -->
                    <div id="fileInfo" class="p-3 bg-gray-50 rounded-lg border border-gray-200">
                        <h3 class="font-medium text-gray-700 mb-2">
                            <i class="fas fa-info-circle mr-2 text-blue-500"></i> File Properties
                        </h3>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div>
                                <span class="text-gray-600 block">Format:</span>
                                <span id="fileFormat" class="font-medium">-</span>
                            </div>
                            <div>
                                <span class="text-gray-600 block">Duration:</span>
                                <span id="fileDuration" class="font-medium">00:00:00</span>
                            </div>
                            <div>
                                <span class="text-gray-600 block">Sample Rate:</span>
                                <span id="fileRate" class="font-medium">-</span>
                            </div>
                            <div>
                                <span class="text-gray-600 block">Bitrate:</span>
                                <span id="fileBitrate" class="font-medium">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- Audio Visualization -->
                    <div class="p-3 bg-gray-50 rounded-lg border border-gray-200">
                        <h3 class="font-medium text-gray-700 mb-4">
                            <i class="fas fa-chart-line mr-2 text-purple-500"></i> Spectrum Analysis
                        </h3>
                        <div class="bg-black rounded-md p-1">
                            <div id="audioVisualizer" class="h-32 bg-gray-900 rounded-sm relative overflow-hidden">
                                <!-- Spectrum bars will be generated by JavaScript -->
                            </div>
                        </div>
                        <div class="mt-2 flex justify-between text-xs text-gray-600">
                            <span>20Hz</span>
                            <span>20kHz</span>
                        </div>
                    </div>

                    <!-- Tutorial Section (initially hidden) -->
                    <div id="tutorialSection" class="hidden p-3 bg-blue-50 rounded-lg border border-blue-100">
                        <h3 class="font-medium text-blue-800 mb-3 flex items-center">
                            <i class="fas fa-graduation-cap mr-2"></i> VocalSep Tutorial
                        </h3>
                        
                        <div class="space-y-3">
                            <div class="tutorial-step p-2 bg-white rounded-lg border border-blue-200">
                                <h4 class="font-medium text-blue-700 flex items-center">
                                    <span class="w-5 h-5 bg-blue-100 text-blue-700 rounded-full flex items-center justify-center mr-2 text-xs">1</span>
                                    Importing Audio
                                </h4>
                                <p class="text-xs text-gray-700 mt-1">
                                    Click the "Import Audio" button to load an MP3 or WAV file. The Web Audio API will decode and analyze the file.
                                </p>
                            </div>
                            
                            <div class="tutorial-step p-2 bg-white rounded-lg border border-blue-200">
                                <h4 class="font-medium text-blue-700 flex items-center">
                                    <span class="w-5 h-5 bg-blue-100 text-blue-700 rounded-full flex items-center justify-center mr-2 text-xs">2</span>
                                    Basic Playback
                                </h4>
                                <p class="text-xs text-gray-700 mt-1">
                                    Use the play/pause/stop buttons to control audio playback. The Web Audio API's AudioContext handles the actual playback.
                                </p>
                            </div>
                            
                            <div class="tutorial-step p-2 bg-white rounded-lg border border-blue-200">
                                <h4 class="font-medium text-blue-700 flex items-center">
                                    <span class="w-5 h-5 bg-blue-100 text-blue-700 rounded-full flex items-center justify-center mr-2 text-xs">3</span>
                                    Applying Effects
                                </h4>
                                <p class="text-xs text-gray-700 mt-1">
                                    Select an effect from the dropdown and click "Apply". This demonstrates connecting Web Audio nodes (BiquadFilter for EQ, etc.).
                                </p>
                            </div>
                            
                            <div class="tutorial-step p-2 bg-white rounded-lg border border-blue-200">
                                <h4 class="font-medium text-blue-700 flex items-center">
                                    <span class="w-5 h-5 bg-blue-100 text-blue-700 rounded-full flex items-center justify-center mr-2 text-xs">4</span>
                                    Visualizing Audio
                                </h4>
                                <p class="text-xs text-gray-700 mt-1">
                                    The spectrum analyzer uses the AnalyserNode to get frequency data and draws it in real-time using requestAnimationFrame.
                                </p>
                            </div>
                            
                            <div class="tutorial-step p-2 bg-white rounded-lg border border-blue-200">
                                <h4 class="font-medium text-blue-700 flex items-center">
                                    <span class="w-5 h-5 bg-blue-100 text-blue-700 rounded-full flex items-center justify-center mr-2 text-xs">5</span>
                                    Creating Voice Separation
                                </h4>
                                <p class="text-xs text-gray-700 mt-1">
                                    While this demo simulates AI separation, real implementations would use machine learning models like Spleeter or Demucs.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Voice Activity -->
                    <div class="p-3 bg-gray-50 rounded-lg border border-gray-200">
                        <h3 class="font-medium text-gray-700 mb-4">
                            <i class="fas fa-people-arrows mr-2 text-orange-500"></i> Voice Activity
                        </h3>
                        <div class="h-8 bg-gray-200 rounded-full overflow-hidden relative">
                            <div class="absolute top-0 bottom-0 left-0 bg-blue-500" style="width: 30%"></div>
                            <div class="absolute top-0 bottom-0 left-30 bg-purple-500" style="width: 45%"></div>
                            <div class="absolute top-0 bottom-0 left-75 bg-gray-400" style="width: 25%"></div>
                        </div>
                        <div class="mt-2 grid grid-cols-3 gap-2 text-xs">
                            <div class="flex items-center">
                                <span class="w-2 h-2 bg-blue-500 rounded-full mr-1"></span>
                                <span>Voice 1</span>
                            </div>
                            <div class="flex items-center">
                                <span class="w-2 h-2 bg-purple-500 rounded-full mr-1"></span>
                                <span>Voice 2</span>
                            </div>
                            <div class="flex items-center">
                                <span class="w-2 h-2 bg-gray-400 rounded-full mr-1"></span>
                                <span>Silence</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Status Bar -->
        <footer class="bg-gray-800 text-gray-300 text-sm p-2">
            <div class="container mx-auto flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <span class="flex items-center">
                        <i id="audioStatusIcon" class="fas fa-microphone-slash mr-1 text-red-400"></i>
                        <span id="audioStatusText">No Audio Loaded</span>
                    </span>
                    <span id="sampleRateInfo" class="flex items-center">
                        <i class="fas fa-tachometer-alt mr-1 text-yellow-400"></i>
                        <span>-</span>
                    </span>
                    <span class="flex items-center">
                        <i class="fas fa-hdd mr-1 text-blue-400"></i>
                        <span>Audio Context: <span id="audioContextStatus">Inactive</span></span>
                    </span>
                </div>
                <div>
                    <span id="webAudioApiInfo" class="flex items-center" title="Web Audio API is used for all audio processing">
                        <i class="fas fa-code text-xs mr-1"></i>
                        <span>Powered by Web Audio API</span>
                    </span>
                </div>
            </div>
        </footer>
    </div>

    <!-- Hidden file input -->
    <input type="file" id="fileInput" accept="audio/*" style="display: none;">
    
    <script>
        // Web Audio API Setup
        let audioContext;
        let audioBuffer = null;
        let sourceNode = null;
        let analyserNode = null;
        let gainNode = null;
        let currentEffect = null;
        let isPlaying = false;
        let startTime = 0;
        let pausedTime = 0;
        let animationFrameId = null;
        
        // Initialize Web Audio API
        function initAudioContext() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyserNode = audioContext.createAnalyser();
                analyserNode.fftSize = 256;
                gainNode = audioContext.createGain();
                gainNode.gain.value = 1.0;
                
                updateAudioContextStatus();
                
                // Setup visualizer
                setupAudioVisualizer();
                
                // Update status bar
                document.getElementById('audioContextStatus').textContent = 'Ready';
                document.getElementById('sampleRateInfo').querySelector('span').textContent = 
                    `${audioContext.sampleRate / 1000}kHz`;
                
                return true;
            } catch (e) {
                console.error('Error initializing audio context:', e);
                document.getElementById('audioContextStatus').textContent = 'Error';
                return false;
            }
        }
        
        // Update audio context state in UI
        function updateAudioContextStatus() {
            if (!audioContext) return;
            
            const statusElement = document.getElementById('audioContextStatus');
            
            if (audioContext.state === 'running') {
                statusElement.textContent = 'Active';
                statusElement.className = 'text-green-400';
            } else if (audioContext.state === 'suspended') {
                statusElement.textContent = 'Paused';
                statusElement.className = 'text-yellow-400';
            } else {
                statusElement.textContent = 'Inactive';
                statusElement.className = 'text-gray-400';
            }
        }
        
        // File Handling
        document.getElementById('importBtn').addEventListener('click', function() {
            document.getElementById('fileInput').click();
        });
        
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            // Initialize audio context if not already done
            if (!audioContext && !initAudioContext()) {
                alert('Error initializing audio system. Please try again.');
                return;
            }
            
            loadAudioFile(file);
        });
        
        function loadAudioFile(file) {
            const fileReader = new FileReader();
            
            fileReader.onload = function(e) {
                const arrayBuffer = e.target.result;
                
                // Show loading state
                document.getElementById('fileNameDisplay').textContent = 'Loading...';
                document.getElementById('audioStatusText').textContent = 'Decoding audio...';
                document.getElementById('audioStatusIcon').className = 'fas fa-spinner fa-spin mr-1 text-blue-400';
                
                audioContext.decodeAudioData(arrayBuffer).then(function(buffer) {
                    audioBuffer = buffer;
                    
                    // Update UI with file info
                    document.getElementById('fileNameDisplay').textContent = file.name;
                    document.getElementById('audioStatusText').textContent = 'Audio loaded';
                    document.getElementById('audioStatusIcon').className = 'fas fa-check-circle mr-1 text-green-400';
                    
                    // Update file info panel
                    updateFileInfo(file, buffer);
                    
                    // Generate waveform visualization
                    visualizeWaveform(buffer);
                    
                }).catch(function(err) {
                    console.error('Error decoding audio data:', err);
                    document.getElementById('fileNameDisplay').textContent = 'Error loading file';
                    document.getElementById('audioStatusText').textContent = 'Error loading audio';
                    document.getElementById('audioStatusIcon').className = 'fas fa-times-circle mr-1 text-red-400';
                });
            };
            
            fileReader.onerror = function() {
                console.error('Error reading file');
                document.getElementById('fileNameDisplay').textContent = 'Error reading file';
                document.getElementById('audioStatusText').textContent = 'Error reading file';
                document.getElementById('audioStatusIcon').className = 'fas fa-times-circle mr-1 text-red-400';
            };
            
            fileReader.readAsArrayBuffer(file);
        }
        
        function updateFileInfo(file, buffer) {
            // File format
            const format = file.name.split('.').pop().toUpperCase();
            document.getElementById('fileFormat').textContent = format;
            
            // Duration
            const duration = buffer.duration;
            const hours = Math.floor(duration / 3600);
            const minutes = Math.floor((duration % 3600) / 60);
            const seconds = Math.floor(duration % 60);
            const formattedTime = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            document.getElementById('fileDuration').textContent = formattedTime;
            
            // Sample rate
            document.getElementById('fileRate').textContent = `${buffer.sampleRate / 1000}kHz`;
            
            // Estimated bitrate (very rough estimation)
            const fileSizeMB = file.size / (1024 * 1024);
            const durationMinutes = duration / 60;
            const bitrate = Math.round((fileSizeMB * 8) / durationMinutes);
            document.getElementById('fileBitrate').textContent = `${bitrate}kbps (estimated)`;
        }
        
        // Playback Controls
        function playAudio() {
            if (!audioBuffer) {
                alert('Please load an audio file first');
                return;
            }
            
            if (isPlaying) {
                pauseAudio();
                return;
            }
            
            // Resume suspended audio context
            if (audioContext.state === 'suspended') {
                audioContext.resume().then(() => {
                    updateAudioContextStatus();
                    startPlayback();
                });
            } else {
                startPlayback();
            }
        }
        
        function startPlayback() {
            if (sourceNode) {
                sourceNode.disconnect();
            }
            
            sourceNode = audioContext.createBufferSource();
            sourceNode.buffer = audioBuffer;
            
            // Create audio chain: source -> effect -> analyser -> gain -> destination
            sourceNode.connect(analyserNode);
            analyserNode.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            sourceNode.onended = function() {
                stopAudio();
            };
            
            startTime = audioContext.currentTime - pausedTime;
            sourceNode.start(0, pausedTime);
            
            isPlaying = true;
            pausedTime = 0;
            
            // Update UI
            document.getElementById('playBtn').querySelector('i').className = 'fas fa-pause text-green-600 mb-1';
            document.getElementById('playBtnLarge').querySelector('i').className = 'fas fa-pause text-2xl';
            document.getElementById('audioStatusText').textContent = 'Playing';
            document.getElementById('audioStatusIcon').className = 'fas fa-play-circle mr-1 text-green-400';
            
            // Start updating time display
            updateTimeDisplay();
            updateAudioContextStatus();
        }
        
        function pauseAudio() {
            if (!isPlaying) return;
            
            pausedTime = audioContext.currentTime - startTime;
            sourceNode.stop();
            sourceNode.disconnect();
            sourceNode = null;
            
            isPlaying = false;
            
            // Update UI
            document.getElementById('playBtn').querySelector('i').className = 'fas fa-play text-green-600 mb-1';
            document.getElementById('playBtnLarge').querySelector('i').className = 'fas fa-play-circle text-2xl';
            document.getElementById('audioStatusText').textContent = 'Paused';
            document.getElementById('audioStatusIcon').className = 'fas fa-pause-circle mr-1 text-yellow-400';
            
            // Stop updating time display
            cancelAnimationFrame(animationFrameId);
            updateAudioContextStatus();
        }
        
        function stopAudio() {
            if (sourceNode) {
                sourceNode.stop();
                sourceNode.disconnect();
                sourceNode = null;
            }
            
            isPlaying = false;
            startTime = 0;
            pausedTime = 0;
            
            // Update UI
            document.getElementById('playBtn').querySelector('i').className = 'fas fa-play text-green-600 mb-1';
            document.getElementById('playBtnLarge').querySelector('i').className = 'fas fa-play-circle text-2xl';
            document.getElementById('timeDisplay').textContent = '00:00:00';
            document.getElementById('audioStatusText').textContent = 'Stopped';
            document.getElementById('audioStatusIcon').className = 'fas fa-stop-circle mr-1 text-red-400';
            
            // Stop updating time display
            cancelAnimationFrame(animationFrameId);
            updateAudioContextStatus();
        }
        
        function updateTimeDisplay() {
            if (!isPlaying) return;
            
            const currentTime = audioContext.currentTime - startTime;
            const hours = Math.floor(currentTime / 3600);
            const minutes = Math.floor((currentTime % 3600) / 60);
            const seconds = Math.floor(currentTime % 60);
            const formattedTime = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            
            document.getElementById('timeDisplay').textContent = formattedTime;
            
            animationFrameId = requestAnimationFrame(updateTimeDisplay);
        }
        
        // Volume Control
        document.getElementById('volumeControl').addEventListener('input', function(e) {
            const volume = e.target.value / 100;
            if (gainNode) {
                gainNode.gain.value = volume;
            }
            document.getElementById('volumeValue').textContent = `${e.target.value}%`;
        });
        
        // Effects
        document.getElementById('applyEffectBtn').addEventListener('click', function() {
            const effectType = document.getElementById('effectSelect').value;
            
            // If same effect is already active, remove it
            if (currentEffect && currentEffect.type === effectType) {
                removeEffect();
                return;
            }
            
            applyEffect(effectType);
        });
        
        function applyEffect(effectType) {
            if (!sourceNode || !analyserNode) return;
            
            // Remove current effect if any
            if (currentEffect) {
                removeEffect();
            }
            
            // Create new effect
            let effectNode;
            
            switch (effectType) {
                case 'highpass':
                    effectNode = audioContext.createBiquadFilter();
                    effectNode.type = 'highpass';
                    effectNode.frequency.value = 1000;
                    break;
                    
                case 'lowpass':
                    effectNode = audioContext.createBiquadFilter();
                    effectNode.type = 'lowpass';
                    effectNode.frequency.value = 1000;
                    break;
                    
                case 'delay':
                    effectNode = audioContext.createDelay(1.0);
                    effectNode.delayTime.value = 0.3;
                    break;
                    
                case 'reverb':
                    // Simple reverb simulation using ConvolverNode
                    effectNode = audioContext.createConvolver();
                    
                    // Create a simple impulse response for reverb
                    const length = audioContext.sampleRate * 2;
                    const impulse = audioContext.createBuffer(2, length, audioContext.sampleRate);
                    const left = impulse.getChannelData(0);
                    const right = impulse.getChannelData(1);
                    
                    for (let i = 0; i < length; i++) {
                        const n = length - i;
                        left[i] = (Math.random() * 2 - 1) * Math.pow(1 - i / length, 3);
                        right[i] = (Math.random() * 2 - 1) * Math.pow(1 - i / length, 3);
                    }
                    
                    effectNode.buffer = impulse;
                    break;
                    
                default:
                    // No effect
                    return;
            }
            
            // Rebuild audio chain with effect
            sourceNode.disconnect();
            sourceNode.connect(effectNode);
            effectNode.connect(analyserNode);
            
            currentEffect = { node: effectNode, type: effectType };
            
            // Show active effect in UI
            document.getElementById('effectSelect').value = effectType;
            document.getElementById('applyEffectBtn').classList.remove('bg-gray-200');
            document.getElementById('applyEffectBtn').classList.add('bg-blue-200');
            
            // Update status
            document.getElementById('audioStatusText').textContent = `Effect: ${effectType}`;
        }
        
        function removeEffect() {
            if (!currentEffect || !sourceNode) return;
            
            // Rebuild audio chain without effect
            sourceNode.disconnect();
            sourceNode.connect(analyserNode);
            
            currentEffect = null;
            
            // Update UI
            document.getElementById('effectSelect').value = 'none';
            document.getElementById('applyEffectBtn').classList.remove('bg-blue-200');
            document.getElementById('applyEffectBtn').classList.add('bg-gray-200');
            
            // Update status
            const status = isPlaying ? 'Playing' : 'Paused';
            document.getElementById('audioStatusText').textContent = status;
        }
        
        // Separated audio buffers
        let maleVoiceBuffer = null;
        let femaleVoiceBuffer = null;
        
        // Voice Separation with Hugging Face API
        document.getElementById('separateBtn').addEventListener('click', function() {
            if (!audioBuffer) {
                alert('Please load an audio file first');
                return;
            }
            
            // Show loading state
            const btn = this;
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-circle-notch fa-spin mr-2"></i> Processing...';
            
            // Get API key if provided
            const apiKey = document.getElementById('hfApiKey').value.trim();
            
            // Call the voice separation API
            separateVoices(apiKey)
                .then(result => {
                    // Show success state
                    btn.innerHTML = '<i class="fas fa-check mr-2"></i> Separation Complete';
                    btn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                    btn.classList.add('bg-green-500', 'hover:bg-green-600');
                    
                    // Show separated tracks
                    document.getElementById('separatedTracks').classList.remove('hidden');
                    document.getElementById('analysisInfo').classList.remove('hidden');
                    
                    // Reset button after delay
                    setTimeout(function() {
                        btn.innerHTML = '<i class="fas fa-magic mr-2"></i> Separate Voices';
                        btn.classList.remove('bg-green-500', 'hover:bg-green-600');
                        btn.classList.add('bg-blue-600', 'hover:bg-blue-700');
                        btn.disabled = false;
                    }, 3000);
                })
                .catch(error => {
                    console.error('Error separating voices:', error);
                    btn.innerHTML = '<i class="fas fa-exclamation-triangle mr-2"></i> Error';
                    btn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                    btn.classList.add('bg-red-600', 'hover:bg-red-700');
                    
                    // Show error message
                    alert('Error separating voices: ' + error.message);
                    
                    // Reset button after delay
                    setTimeout(function() {
                        btn.innerHTML = '<i class="fas fa-magic mr-2"></i> Separate Voices';
                        btn.classList.remove('bg-red-600', 'hover:bg-red-700');
                        btn.classList.add('bg-blue-600', 'hover:bg-blue-700');
                        btn.disabled = false;
                    }, 3000);
                });
        });
        
        // Function to separate voices using Hugging Face API
        async function separateVoices(apiKey) {
            // Check if we have an API key
            if (!apiKey) {
                // If no API key, use simulation mode
                console.log("No API key provided, using simulation mode");
                return new Promise((resolve, reject) => {
                    // Simulate API processing time
                    setTimeout(() => {
                        try {
                            // Create simulated separated audio buffers
                            createSimulatedSeparatedTracks();
                            resolve({ success: true, simulated: true });
                        } catch (error) {
                            reject(error);
                        }
                    }, 3000);
                });
            }
            
            // With API key, make the actual API call
            try {
                // Convert audio buffer to WAV file
                const wavBlob = audioBufferToWav(audioBuffer);
                
                // Create form data for API request
                const formData = new FormData();
                formData.append('file', wavBlob, 'audio.wav');
                
                // Make API request to Hugging Face
                const response = await fetch(
                    'https://api-inference.huggingface.co/models/facebook/demucs',
                    {
                        headers: { Authorization: `Bearer ${apiKey}` },
                        method: 'POST',
                        body: formData
                    }
                );
                
                if (!response.ok) {
                    throw new Error(`API request failed: ${response.statusText}`);
                }
                
                // Process the response
                const result = await response.json();
                
                // For now, we'll still use simulated tracks since processing the actual
                // response requires additional handling specific to the model's output format
                createSimulatedSeparatedTracks();
                
                return { success: true, apiResponse: result };
            } catch (error) {
                console.error("API call failed:", error);
                throw error;
            }
        }
        
        // Function to create simulated separated tracks for demo purposes
        function createSimulatedSeparatedTracks() {
            // Create simulated male voice buffer (lower frequencies emphasized)
            maleVoiceBuffer = audioContext.createBuffer(
                audioBuffer.numberOfChannels,
                audioBuffer.length,
                audioBuffer.sampleRate
            );
            
            // Create simulated female voice buffer (higher frequencies emphasized)
            femaleVoiceBuffer = audioContext.createBuffer(
                audioBuffer.numberOfChannels,
                audioBuffer.length,
                audioBuffer.sampleRate
            );
            
            // Copy and modify the original audio data to simulate separation
            for (let channel = 0; channel < audioBuffer.numberOfChannels; channel++) {
                const originalData = audioBuffer.getChannelData(channel);
                const maleData = maleVoiceBuffer.getChannelData(channel);
                const femaleData = femaleVoiceBuffer.getChannelData(channel);
                
                // Simple simulation - not actual voice separation
                for (let i = 0; i < originalData.length; i++) {
                    // Male voice gets more of the original signal in the first half
                    // Female voice gets more in the second half
                    // This is just for visualization purposes
                    const position = i / originalData.length;
                    const maleEmphasis = Math.cos(position * Math.PI) * 0.5 + 0.5;
                    const femaleEmphasis = Math.sin(position * Math.PI) * 0.5 + 0.5;
                    
                    maleData[i] = originalData[i] * maleEmphasis;
                    femaleData[i] = originalData[i] * femaleEmphasis;
                }
            }
            
            // Visualize the separated waveforms
            visualizeWaveform(maleVoiceBuffer, 'maleWaveform');
            visualizeWaveform(femaleVoiceBuffer, 'femaleWaveform');
            
            // Set up playback for separated tracks
            setupSeparatedTrackPlayback();
        }
        
        // Function to visualize waveform for a specific container
        function visualizeWaveform(buffer, containerId) {
            const waveContainer = document.getElementById(containerId);
            if (!waveContainer) return;
            
            waveContainer.innerHTML = '';
            
            // Get the first channel data
            const data = buffer.getChannelData(0);
            const step = Math.ceil(data.length / 100); // Sample only 100 points
            
            // Create SVG for waveform
            const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            svg.setAttribute('viewBox', '0 0 100 40');
            svg.setAttribute('preserveAspectRatio', 'none');
            svg.style.width = '100%';
            svg.style.height = '100%';
            
            // Create path
            const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
            path.setAttribute('stroke', 'currentColor');
            path.setAttribute('fill', 'none');
            path.setAttribute('stroke-width', '1');
            
            // Build path data
            let pathData = '';
            
            for (let i = 0; i < 100; i++) {
                const idx = Math.floor(i * step);
                const value = data[idx] || 0;
                const y = 20 - (value * 15); // Scale the amplitude
                
                if (i === 0) {
                    pathData += `M 0 ${y} `;
                } else {
                    pathData += `L ${i} ${y} `;
                }
            }
            
            path.setAttribute('d', pathData);
            svg.appendChild(path);
            waveContainer.appendChild(svg);
        }
        
        // Set up playback for separated tracks
        function setupSeparatedTrackPlayback() {
            // Male voice playback
            document.getElementById('playMaleBtn').addEventListener('click', function() {
                if (!maleVoiceBuffer) return;
                playBuffer(maleVoiceBuffer);
            });
            
            // Female voice playback
            document.getElementById('playFemaleBtn').addEventListener('click', function() {
                if (!femaleVoiceBuffer) return;
                playBuffer(femaleVoiceBuffer);
            });
            
            // Male voice download
            document.getElementById('downloadMaleBtn').addEventListener('click', function() {
                if (!maleVoiceBuffer) return;
                downloadBuffer(maleVoiceBuffer, 'male_voice.wav');
            });
            
            // Female voice download
            document.getElementById('downloadFemaleBtn').addEventListener('click', function() {
                if (!femaleVoiceBuffer) return;
                downloadBuffer(femaleVoiceBuffer, 'female_voice.wav');
            });
        }
        
        // Play a specific audio buffer
        function playBuffer(buffer) {
            if (isPlaying) {
                stopAudio();
            }
            
            sourceNode = audioContext.createBufferSource();
            sourceNode.buffer = buffer;
            
            sourceNode.connect(analyserNode);
            analyserNode.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            sourceNode.onended = function() {
                stopAudio();
            };
            
            startTime = audioContext.currentTime;
            sourceNode.start(0);
            
            isPlaying = true;
            
            // Update UI
            document.getElementById('playBtn').querySelector('i').className = 'fas fa-pause text-green-600 mb-1';
            document.getElementById('playBtnLarge').querySelector('i').className = 'fas fa-pause text-2xl';
            document.getElementById('audioStatusText').textContent = 'Playing separated voice';
            document.getElementById('audioStatusIcon').className = 'fas fa-play-circle mr-1 text-green-400';
            
            // Start updating time display
            updateTimeDisplay();
            updateAudioContextStatus();
        }
        
        // Convert an audio buffer to WAV format and download it
        function downloadBuffer(buffer, filename) {
            // Create WAV file from buffer
            const wavBlob = audioBufferToWav(buffer);
            
            // Create download link
            const url = URL.createObjectURL(wavBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            
            // Trigger download
            document.body.appendChild(link);
            link.click();
            
            // Clean up
            document.body.removeChild(link);
            setTimeout(() => URL.revokeObjectURL(url), 100);
        }
        
        // Convert AudioBuffer to WAV Blob
        function audioBufferToWav(buffer) {
            const numOfChan = buffer.numberOfChannels;
            const length = buffer.length * numOfChan * 2;
            const sampleRate = buffer.sampleRate;
            const bitsPerSample = 16;
            const bytesPerSample = bitsPerSample / 8;
            const blockAlign = numOfChan * bytesPerSample;
            const byteRate = sampleRate * blockAlign;
            const dataSize = buffer.length * numOfChan * bytesPerSample;
            
            const arrayBuffer = new ArrayBuffer(44 + dataSize);
            const view = new DataView(arrayBuffer);
            
            // RIFF identifier
            writeString(view, 0, 'RIFF');
            // RIFF chunk length
            view.setUint32(4, 36 + dataSize, true);
            // RIFF type
            writeString(view, 8, 'WAVE');
            // format chunk identifier
            writeString(view, 12, 'fmt ');
            // format chunk length
            view.setUint32(16, 16, true);
            // sample format (raw)
            view.setUint16(20, 1, true);
            // channel count
            view.setUint16(22, numOfChan, true);
            // sample rate
            view.setUint32(24, sampleRate, true);
            // byte rate (sample rate * block align)
            view.setUint32(28, byteRate, true);
            // block align (channel count * bytes per sample)
            view.setUint16(32, blockAlign, true);
            // bits per sample
            view.setUint16(34, bitsPerSample, true);
            // data chunk identifier
            writeString(view, 36, 'data');
            // data chunk length
            view.setUint32(40, dataSize, true);
            
            // Write the PCM samples
            const offset = 44;
            let pos = offset;
            
            for (let i = 0; i < buffer.length; i++) {
                for (let channel = 0; channel < numOfChan; channel++) {
                    const sample = Math.max(-1, Math.min(1, buffer.getChannelData(channel)[i]));
                    const int16 = sample < 0 ? sample * 0x8000 : sample * 0x7FFF;
                    view.setInt16(pos, int16, true);
                    pos += 2;
                }
            }
            
            return new Blob([view], { type: 'audio/wav' });
        }
        
        // Helper function to write a string to a DataView
        function writeString(view, offset, string) {
            for (let i = 0; i < string.length; i++) {
                view.setUint8(offset + i, string.charCodeAt(i));
            }
        }
        
        // Audio Visualization
        function setupAudioVisualizer() {
            const visualizer = document.getElementById('audioVisualizer');
            visualizer.innerHTML = '';
            
            // Create frequency bars
            for (let i = 0; i < 64; i++) {
                const bar = document.createElement('div');
                bar.className = 'absolute bottom-0 w-px bg-gradient-to-t from-blue-500 to-purple-500';
                bar.style.left = `${(i / 64) * 100}%`;
                bar.style.height = '0%';
                visualizer.appendChild(bar);
            }
            
            // Start visualization update loop
            updateVisualizer();
        }
        
        function updateVisualizer() {
            if (!analyserNode) {
                requestAnimationFrame(updateVisualizer);
                return;
            }
            
            const frequencyData = new Uint8Array(analyserNode.frequencyBinCount);
            analyserNode.getByteFrequencyData(frequencyData);
            
            const bars = document.getElementById('audioVisualizer').children;
            
            for (let i = 0; i < bars.length; i++) {
                // Only show lower frequencies (skip the very high ones)
                const index = Math.floor(i * 1.5);
                const value = frequencyData[index] || 0;
                
                // Scale the value to make it look more natural
                const scaledValue = Math.pow(value / 255, 1.5) * 100;
                bars[i].style.height = `${scaledValue}%`;
                
                // Add some color variation
                if (Math.random() > 0.7) {
                    if (Math.random() > 0.5) {
                        bars[i].className = 'absolute bottom-0 w-px bg-gradient-to-t from-green-400 to-blue-400';
                    } else {
                        bars[i].className = 'absolute bottom-0 w-px bg-gradient-to-t from-blue-500 to-purple-500';
                    }
                }
            }
            
            requestAnimationFrame(updateVisualizer);
        }
        
        // Waveform Visualization
        function visualizeWaveform(buffer) {
            const waveContainer = document.getElementById('originalWaveform');
            waveContainer.innerHTML = '';
            
            // Get the first channel data
            const data = buffer.getChannelData(0);
            const step = Math.ceil(data.length / 100); // Sample only 100 points
            
            // Create SVG for waveform
            const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            svg.setAttribute('viewBox', '0 0 100 40');
            svg.setAttribute('preserveAspectRatio', 'none');
            svg.style.width = '100%';
            svg.style.height = '100%';
            
            // Create path
            const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
            path.setAttribute('stroke', 'currentColor');
            path.setAttribute('fill', 'none');
            path.setAttribute('stroke-width', '1');
            
            // Build path data
            let pathData = '';
            
            for (let i = 0; i < 100; i++) {
                const idx = Math.floor(i * step);
                const value = data[idx] || 0;
                const y = 20 - (value * 15); // Scale the amplitude
                
                if (i === 0) {
                    pathData += `M 0 ${y} `;
                } else {
                    pathData += `L ${i} ${y} `;
                }
            }
            
            path.setAttribute('d', pathData);
            svg.appendChild(path);
            waveContainer.appendChild(svg);
        }
        
        // Tutorial Toggle
        document.getElementById('tutorialBtn').addEventListener('click', function() {
            const tutorialSection = document.getElementById('tutorialSection');
            if (tutorialSection.classList.contains('hidden')) {
                tutorialSection.classList.remove('hidden');
                this.innerHTML = '<i class="fas fa-times mr-2"></i> Close Tutorial';
                this.classList.remove('bg-blue-500', 'hover:bg-blue-600');
                this.classList.add('bg-purple-500', 'hover:bg-purple-600');
            } else {
                tutorialSection.classList.add('hidden');
                this.innerHTML = '<i class="fas fa-graduation-cap mr-2"></i> Tutorial';
                this.classList.remove('bg-purple-500', 'hover:bg-purple-600');
                this.classList.add('bg-blue-500', 'hover:bg-blue-600');
            }
        });
        
        // Button Event Listeners
        document.getElementById('playBtn').addEventListener('click', playAudio);
        document.getElementById('playBtnLarge').addEventListener('click', playAudio);
        document.getElementById('pauseBtn').addEventListener('click', pauseAudio);
        document.getElementById('stopBtn').addEventListener('click', stopAudio);
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Try to initialize audio context on first user interaction
            document.body.addEventListener('click', function init() {
                initAudioContext();
                document.body.removeEventListener('click', init);
            }, { once: true });
            
            // Set up tooltips for tutorial steps
            const steps = document.querySelectorAll('.tutorial-step');
            steps.forEach(step => {
                step.addEventListener('click', function() {
                    this.classList.add('ring-2', 'ring-blue-400');
                    setTimeout(() => {
                        this.classList.remove('ring-2', 'ring-blue-400');
                    }, 1000);
                });
            });
        });
    </script>
<p style="border-radius: 8px; text-align: center; font-size: 12px; color: #fff; margin-top: 16px;position: fixed; left: 8px; bottom: 8px; z-index: 10; background: rgba(0, 0, 0, 0.8); padding: 4px 8px;">Made with <img src="https://enzostvs-deepsite.hf.space/logo.svg" alt="DeepSite Logo" style="width: 16px; height: 16px; vertical-align: middle;display:inline-block;margin-right:3px;filter:brightness(0) invert(1);"><a href="https://enzostvs-deepsite.hf.space" style="color: #fff;text-decoration: underline;" target="_blank" >DeepSite</a> - <a href="https://enzostvs-deepsite.hf.space?remix=7Zeux/vocalsep" style="color: #fff;text-decoration: underline;" target="_blank" >?? Remix</a></p></body>
</html>
